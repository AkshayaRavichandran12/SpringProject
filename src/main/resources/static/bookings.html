<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Bookings | PetConnect</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
	body { font-family: 'Poppins', sans-serif; transition: background-color 0.4s, color 0.4s; }
	   body.light-mode { background-color: #fff0f5; color: #333; }
	   body.dark-mode { background-color: #121212; color: #f8f9fa; }

	   .navbar { transition: background-color 0.4s; }
	   .navbar.light-mode { background-color: #ff8fb2; }
	   .navbar.dark-mode { background-color: #000; }

	   .nav-link { color: white !important; margin-right: 15px; font-weight: 500; }
	   .nav-link:hover { color: #333 !important; }         
.booking-card {
  border-radius: 15px;
  border: 2px solid #ffb6c1;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 15px rgba(255,105,180,0.2);
}

body.dark-mode .booking-card {
  background-color: #1e1e1e;
}

.btn-rose {
  background-color: #ff5d8f; color:white;
  border:none;
}

.section-title {
  margin-top:40px;
}
</style>
</head>

<body class="light-mode">

	<nav class="navbar navbar-expand-lg shadow-sm fixed-top light-mode">
	  <div class="container">
	    <a class="navbar-brand" href="#">üêæ PetConnect</a>
	    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
	      <span class="navbar-toggler-icon"></span>
	    </button>
	    <div class="collapse navbar-collapse" id="navbarNav">
	      <ul class="navbar-nav ms-auto align-items-center">
	        <li class="nav-item"><a class="nav-link active" href="Home.html">Home</a></li>
	        <li class="nav-item"><a class="nav-link" href="adopt.html">Adopt</a></li>
	        <li class="nav-item"><a class="nav-link" href="AddPets.html">Add Pets</a></li>
	        <li class="nav-item"><a class="nav-link" href="bookings.html">Bookings</a></li>
	        <li class="nav-item"><a class="nav-link" href="profile.html">My Profile</a></li>
	      </ul>
	      <div class="form-check form-switch ms-3">
	        <input class="form-check-input" type="checkbox" id="darkModeSwitch">
	        <label class="form-check-label text-dark fw-bold" for="darkModeSwitch">üåô</label>
	      </div>
	    </div>
	  </div>
	</nav>


<div class="container" style="margin-top:100px;">
<h3>My Bookings üìã</h3>

<div id="sentBookingsList"></div>
<div id="receivedBookingsList"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

	<script>
	async function loadBookings() {

	  const userStr = localStorage.getItem("petconnect_user");
	  if(!userStr){
	    alert("Please login!");
	    return;
	  }

	  const user = JSON.parse(userStr);

	  const sentList = document.getElementById("sentBookingsList");
	  const receivedList = document.getElementById("receivedBookingsList");

	  try {

	    const res = await fetch(`http://localhost:8000/api/bookings/user/${user.id}`);
	    const data = await res.json();

	    const sentBookings = data.sentBookings;
	    const receivedBookings = data.receivedBookings;

	    // ------------- SENT BOOKINGS -------------
	    let sentHTML = "<h4>Sent Bookings üì®</h4>";

	    if(sentBookings.length === 0)
	      sentHTML += "<p>No sent bookings.</p>";

	    sentBookings.forEach(b => {

	      let actionBtn = "";
	      let contact = "";

	      if(b.status === "ACCEPTED"){
	        actionBtn = `<button class="btn btn-success" disabled>‚úÖ Accepted</button>`;

	        contact = `
	          <p><b>User Contact (You)</b></p>
	          <p>üìû ${b.user.phone}</p>
	          <p>üìß ${b.user.email}</p>
	        `;

	      } else {
	        actionBtn = `<button class="btn btn-danger cancelBtn" data-id="${b.id}">Cancel ‚ùå</button>`;
	      }

	      sentHTML += `
	        <div class="booking-card">
	          <h6>${b.petName}</h6>
	          <p>Date: ${b.bookingDate}</p>
	          ${contact}
	          ${actionBtn}
	        </div>
	      `;
	    });

	    sentList.innerHTML = sentHTML;


	    // ------------- RECEIVED BOOKINGS -------------
	    let receivedHTML = "<h4>Received Bookings üì¨</h4>";

	    if(receivedBookings.length === 0)
	      receivedHTML += "<p>No received bookings.</p>";

	    receivedBookings.forEach(b => {

	      let buttons = "";
	      let contact = "";

	      if(b.status === "ACCEPTED"){
	        buttons = `<button class="btn btn-success" disabled>‚úÖ Accepted</button>`;

	        contact = `
	          <p><b>User Contact</b></p>
	          <p>üìû ${b.user.phone}</p>
	          <p>üìß ${b.user.email}</p>
	        `;

	      } else {
	        buttons = `
	          <button class="btn btn-success acceptBtn" data-id="${b.id}">Accept ‚úÖ</button>
	          <button class="btn btn-danger cancelBtn" data-id="${b.id}">Reject ‚ùå</button>
	        `;
	      }

	      receivedHTML += `
	        <div class="booking-card">
	          <h6>${b.petName}</h6>
	          <p>Date: ${b.bookingDate}</p>
	          ${contact}
	          ${buttons}
	        </div>
	      `;
	    });

	    receivedList.innerHTML = receivedHTML;


	    // ---------------- BUTTON EVENTS ----------------

	    document.querySelectorAll(".cancelBtn").forEach(btn => {
	      btn.onclick = async () => {
	        let id = btn.getAttribute("data-id");

	        let res = await fetch(`http://localhost:8000/api/bookings/${id}`, {
	          method: "DELETE"
	        });

	        let msg = await res.text();
	        alert(msg);
	        loadBookings();
	      }
	    });

	    document.querySelectorAll(".acceptBtn").forEach(btn => {
	      btn.onclick = async () => {
	        let id = btn.getAttribute("data-id");

	        let res = await fetch(`http://localhost:8000/api/bookings/${id}/accept`, {
	          method: "PUT"
	        });

	        let data = await res.json();
	        alert(data.message || "Accepted");

	        loadBookings();
	      }
	    });

	  } catch(err){
	    console.error("JS ERROR:", err);
	    alert("Frontend error fixed. Reload now.");
	  }
	}

	window.onload = loadBookings;
	</script>


</body>
</html>
